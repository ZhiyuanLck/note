# 值类别

每个表达式都具有某种**非引用类型**，且每个表达式只属于三种基本值类别中的一种：左值(lvalue)、亡值(xvalue)、纯右值(prvalue)。

在三种基本值类别的上一层是泛左值(glvalue)和右值(rvalue)，泛左值是求值后能**确定一个对象、位域或函数的身份**的表达式，而右值指亡值或者纯右值。

泛左值包括左值和亡值。亡值那些**资源能够被重新使用**的泛左值（通常因为已经接近其生命周期了）；左值则是不是亡值的泛左值。

右值包括亡值和纯右值。纯右值则是求值后用来**初始化**一个对象或位域，或者用来计算操作符的一个操作数的值（取决于上下文），或者是值类型为`cv void`的表达式。

从是否拥有身份(identity)的角度来看，左值和亡值都是求值之后可以确定身份的表达式，而右值并不能确定身份。[身份](https://stackoverflow.com/a/53450666/9514052)即唯一标识：

- 表达式里的变量名只能指定一个对象，因此代表一个身份
- 同一时间的同一个地址不可能存在相同类型的两个对象，因此地址就是一个唯一标识，解引用一个指针给出一个左值
- 引用总是指定一个实体，因此返回引用的函数都生成一个泛左值
- 纯右值没有绑定任何对象，因此不具有身份（也不能访问其地址）
- 亡值则是其地址已经不能能被程序访问（可以通过右值引用延长其生命周期）

从移动语义的角度来看

- 拥有身份且不可被移动的表达式是左值
- 拥有身份可被移动的表达式是亡值
- 没有身份可被移动的表达式是纯右值
- 没有身份且不可被移动的表达式无法使用
- 拥有身份的表达式是泛左值
- 可被移动的表达式是右值

## 右值性质

- 右值不能由内建的取址运算符取地址
- 右值不能用作内建赋值运算符及内建复合赋值运算符的左操作数
- 右值可以用于**初始化 const 左值引用**，这种情况下该右值所标识的对象的生存期被延长到该引用的作用域结尾
- 右值可以用于**初始化右值引用**，这种情况下该右值所标识的对象的生存期被延长到该引用的作用域结尾
- 当被用作函数实参且该函数有两种重载可用，其中之一接受右值引用的形参而另一个接受 const 的左值引用的形参时，**右值将被绑定到右值引用的重载之上**（从而，当复制与移动构造函数均可用时，以右值实参将调用其移动构造函数，复制和移动赋值运算符与此类似）

## 纯右值性质

- 纯右值不具有多态：它所标识的对象的动态类型始终为该表达式的类型
- 非类非数组的纯右值不能被 cv 限定。（注意：函数调用或转型表达式可能生成非类的 cv 限定类型的纯右值，但其 cv 限定符被立即剥除。）
- 纯右值不能具有不完整类型（除了类型 void，或在 decltype 说明符中使用）
- 纯右值不能具有抽象类类型或其数组类型

## 泛左值性质

- 泛左值可以通过左值到右值、数组到指针或函数到指针隐式转换转换成纯右值
- 泛左值可以是多态的：其所标识的对象的动态类型不必是该表达式的静态类型
- 泛左值可以具有不完整类型，只要表达式中容许

## 左值性质

- 可以由内建的取址运算符取左值的地址
- 可修改的左值可用作内建赋值和内建复合赋值运算符的左操作数
- 左值可用于初始化左值引用；这会将一个新名字关联给该表达式所标识的对象

## 亡值性质

与所有的右值类似，亡值可以绑定到右值引用上，而且与所有的泛左值类似，亡值可以是多态的，而且非类的亡值可以有 cv 限定


## 参考链接

[value category cheatsheet](https://github.com/jeaye/value-category-cheatsheet/blob/master/value-category-cheatsheet.pdf)

https://en.cppreference.com/w/cpp/language/value_category

https://docs.microsoft.com/en-us/cpp/cpp/lvalues-and-rvalues-visual-cpp?view=msvc-160
