# 浮点数

目前计算机上最常用的实数表示形式为IEEE Standard 754浮点数

## 浮点数表示形式

浮点数用科学计数法通过一个基数和一个指数来编码数字，下面用一个三元组来表示浮点数，(a, b, c) 中b为基数，c为指数。

- 十进制下   123.456   可被表示为 (1.23456,   10, 2)
- 十六进制下 123.abc   可被表示为 (1.23abc,   16, 2)
- 二进制下   10100.110 可被表示为 (1.0100110, 2,  4)

Value = sign X exponent bias X fraction

即浮点数实际值等于符号位乘以指数偏移值再乘以分数值。

## 内存布局

浮点数由3部分组成：符号、指数、分数。基数默认为2无需存储。

下表表示单精度和双精度浮点数的内存分布，00表示最低有效位(least-significant bit)。

精度   | 符号  | 指数      | 分数
----   | ----  | ----      | ----
单精度 | 1[31] | 8[30-23]  | 23[22-00]
双精度 | 1[63] | 11[62-52] | 52[51-00]

### 符号位

最高有效位，0代表负数，1代表正数

### 指数偏移值

浮点数表示法中指数域的编码值，等于指数的实际值加上某个固定的值，IEEE 754标准规定该固定值为 2^(e - 1) - 1，其中的e为存储指数的比特的长度。

比如单精度浮点数的指数域为8比特，则固定偏移值为 2^(8 - 1) - 1 = 127。如果指数实际值为17(10进制)，则单精度浮点数中的指数域编码之为 144 = 17 + 127。

使用**偏移值的好处**是可以用e个比特的无符号整数来表示所有的指数取值，实际可以按照**字典序**比较两个浮点表示的大小。

### 规约形式的浮点数

如果浮点数中指数部分的编码值在1 <= exponent <= 2^e - 2之间，且在科学计数法的表示方式下，分数部分的最高有效位是1，则浮点数称为规约形式的浮点数。“规约”指用唯一确定的浮点形式去表示一个值。

这种情况下尾数有一位隐含的二进制有效数字，被称为**有效数**。

比如双精度的规约形式指数域的值域为000 0000 0001(11-bit)到111 1111 1110，分数部分的值域为000...000到111...111(52bit)。

### 非规约形式的浮点数

非规约形式的浮点数指数部分编码值为0(单精度实际值为-127，非常小)，分数部分不为0。只有当某个数字相当接近0时才使用非规约形式的浮点数来表示。

IEEE 754标准规定：**非规约形式的浮点数的指数偏移值比规约形式的浮点数的指数偏移值小1**。即规约与非规约形式的浮点数的指数实际值最小(单精度)都为-126，但是规约形式的浮点数尾数1 <= fraction < 2，而非规约形式的浮点数尾数0 < fraction < 1.

*可以尝试写出规约形式浮点数和非规约形式浮点数最大值和最小值*
==> [参考链接](https://zh.wikipedia.org/wiki/IEEE_754)

### 特殊的浮点数

前面预留了大小为0和 2^e - 1 的指数编码值，下面说明它们的作用

| 形式   | 符号 | 实际指数 | 指数编码 | 小数部分
| ----   | ---- | -------- | -------- | -------
| +0     | +    | -127     | 0        | 0
| -0     | -    | -127     | 0        | 0
| 正无穷 | +    | 128      | 255      | 0
| 负无穷 | -    | 128      | 255      | 0
| NaN    | \*   | 128      | 255      | 非0

### 有效数字

单精度和双精度的有效数字分别是有存储的23和52位，再加上左侧隐式的第一位，即有24和53位。

而 log 2^24 = 7.22, log 2^53 = 15.95，即单精度和双精度浮点数可以保证7位和15位十进制有效数字。
